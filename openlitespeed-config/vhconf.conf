# Virtual Host Configuration for MERN App
docRoot                   $VH_ROOT/frontend/dist/
vhDomain                  example.com
adminEmails               admin@example.com

index  {
  useServer               0
  indexFiles              index.html
  autoIndex               0
}

errorpage 404 {
  url                     /404.html
}

accessControl  {
  allow                   *
  deny
}

realm example.com {
  userDB  {
    location              $SERVER_ROOT/conf/htpasswd
  }
}

# Security settings
security  {
  enableSPDY              0
  enableQuic              0
  enableGzip              1
  enableBr                0
  disableInitLogRotation  0
  forceStrictOwnership    1
}

# PHP settings (if needed for future extensions)
phpIniOverride  {
}

# Context for API proxy to Node.js backend
context /api/ {
  type                    proxy
  handler                 proxy:127.0.0.1:5000
  addDefaultCharset       off

  rewrite  {
    enable                1
    rules                 <<<END_rules
RewriteRule ^/api/(.*)$ http://127.0.0.1:5000/api/$1 [P,L]
END_rules
  }
}

# Static file caching
expires  {
  enableExpires           1
  expiresByType           image/*=A604800,text/css=A604800,application/javascript=A604800,application/json=A3600
}
